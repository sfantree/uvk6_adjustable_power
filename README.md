# uvk6_adjustable_power

泉盛uvk5/k6可微调发射功率0-5W调节间隔0.1W，基于luoshihu固件0.13.2版本修改，可用于QRP，中继传播，天线效果等。

QRP：最低功率通联

中继传播：在不同位置测试中继回波的最小功率，预测衰耗和传播范围。

天线效果：假设能打上中继的原厂天线最小功率1W，自制天线0.25W，可以推算自制天线相对增益有6dbm，配合场强表可以做到更精细的量化。

### 使用说明

编译可以借助action，跑完会有个LOSEHU132E.bin。这是最精简的测试版，其他需求可以照着luoshihu项目说明进行添加。

进入设置切换到QRP Pwr（第34）的菜单，切换不同的Factor，还有配合F+6的高中低三档，修改不同的Txp值。Txp值更新后会在QRP Pwr菜单中显示。功率和Txp值可以参考下表。

### 测试结果

这是k6在80%的电量下，使用SW102驻波表测试的功率数据，仅供参考。实际测试发现功率还和这些因素有关系：频率，驻波，损耗，电量等。

结果说明：Factor=16 Txp=115以上是最大功率发射，Factor小于16对输出功率影响不大。Factor=45 Txp=28以下实际有发射，sdr和场强表可以检测到，因为低于SW102驻波表的最小灵敏度没有示数

| Factor | L   | M   | H   | 432.5mhz/80%电量 | 146.5mhz/80%电量 |
| -------- | ----- | ----- | ----- | ---------------- | ---------- |
| 0      | 90  | 100 | 156 |                |          |
| 1      | 159 | 160 | 161 |                |          |
| 2      | 156 | 157 | 158 |                |          |
| 3      | 153 | 154 | 155 |                |          |
| 4      | 150 | 151 | 152 |                |          |
| 5      | 147 | 148 | 149 |                |          |
| 6      | 144 | 145 | 146 |                |          |
| 7      | 141 | 142 | 143 |                |          |
| 8      | 138 | 139 | 140 |                |          |
| 9      | 135 | 136 | 137 |                |          |
| 10     | 132 | 133 | 134 |                |          |
| 11     | 129 | 130 | 131 |                |          |
| 12     | 126 | 127 | 128 |                |          |
| 13     | 123 | 124 | 125 |                |          |
| 14     | 120 | 121 | 122 |                |          |
| 15     | 117 | 118 | 119 |                |          |
| 16     | 114 | 115 | 116 | 5W             |          |
| 17     | 111 | 112 | 113 |                |          |
| 18     | 108 | 109 | 110 | 4.8W           |          |
| 19     | 105 | 106 | 107 |                |          |
| 20     | 102 | 103 | 104 | 4.5W           |          |
| 21     | 99  | 100 | 101 | 4.25W          |          |
| 22     | 96  | 97  | 98  |                |          |
| 23     | 93  | 94  | 95  | 4W             | 3W       |
| 24     | 90  | 91  | 92  |                |          |
| 25     | 87  | 88  | 89  |                |          |
| 26     | 84  | 85  | 86  | 3.5W           | 2.6W     |
| 27     | 81  | 82  | 83  |                |          |
| 28     | 78  | 79  | 80  | 3W             |          |
| 29     | 75  | 76  | 77  |                |          |
| 30     | 72  | 73  | 74  | 2.5W           | 2.15W    |
| 31     | 69  | 70  | 71  |                |          |
| 32     | 66  | 67  | 68  |                |          |
| 33     | 63  | 64  | 65  | 2W             |          |
| 34     | 60  | 61  | 62  | 1.8W           |          |
| 35     | 57  | 58  | 59  | 1.65W          |          |
| 36     | 54  | 55  | 56  | 1.5W           |          |
| 37     | 51  | 52  | 53  |                |          |
| 38     | 48  | 49  | 50  | 1.2W           | 1.35W    |
| 39     | 45  | 46  | 47  |                |          |
| 40     | 42  | 43  | 44  | 1.0W           |          |
| 41     | 39  | 40  | 41  | 0.7W           |          |
| 42     | 36  | 37  | 38  | 0.5W           |          |
| 43     | 33  | 34  | 35  | 0.35W          | 0.6W     |
| 44     | 30  | 31  | 32  | 0.2W           |          |
| 45     | 27  | 28  | 29  | 0.05W          |          |
| 46     | 24  | 25  | 26  |                |          |
| 47     | 21  | 22  | 23  |                |          |
| 48     | 18  | 19  | 20  |                |          |
| 49     | 15  | 16  | 17  |                |          |
| 50     | 12  | 13  | 14  |                |          |
| 51     | 9   | 10  | 11  |                |          |
| 52     | 6   | 7   | 8   |                |          |
| 53     | 3   | 4   | 5   |                |          |
| 54     | 0   | 1   | 2   |                |          |


### 修改说明

新建菜单定义菜单ID

```c
#ifdef ENABLE_CUSTOM_POWER
    MENU_CUSTOM_POWER,
#endif
```

菜单显示逻辑

```c
void UI_DisplayMenu(void) {
    switch (UI_MENU_GetCurrentMenuId()) {
        case MENU_CUSTOM_POWER:
            //sprintf(String, "%d", gSubMenuSelection);
            //sprintf(String, "%d,%d,%d,%d", gSubMenuSelection, gTxp0, gTxp1, gTxp2);
            sprintf(String, "factor: %d\ntxp: %d,%d,%d", gSubMenuSelection, gTxp0, gTxp1, gTxp2);
            break;
}
```

菜单设置逻辑

```c
void MENU_AcceptSetting(void) {
    switch (UI_MENU_GetCurrentMenuId()) {
        default:
            return;
        case MENU_CUSTOM_POWER:
            gEeprom.CUSTOM_POWER_FACTOR = gSubMenuSelection;
            //gVfoConfigureMode = VFO_CONFIGURE;
            gVfoConfigureMode = VFO_CONFIGURE_RELOAD;
            break;
```

菜单选项范围

```c
int MENU_GetLimits(uint8_t menu_id, int32_t *pMin, int32_t *pMax) {
    switch (menu_id) {
        case MENU_CUSTOM_POWER:
            *pMin = 0;
            *pMax = 54;
            break;
```


